module.exports = sysinfo;
module.exports.get = get;
module.app = {};

var fs = require("fs");
var path = require("path");

function sysinfo(_app, router) {
  app = module.app = _app;

  // Register the client side of this plugin so that it is sent to the browser.
  //  Note that the generic name 'irulan_client_app.js' is translated to a
  //  specific name that more clearly identifies it ('irulansysinfo.js')
  app.ClientScripts['single page application'].push({
    name: 'irulansysinfo.js',
    offline_path: app.Settings['node modules directory'] + '/irulansysinfo/irulan_client_app.js'
  })

  // Inject handlers for RESTful requests for page content
  router.get(/^\/pages\/sysinfo\//, function (req, res, next) {
    sysinfo.get(req, res, next);
  })
  router.get(/^\/pages\/sysinfo:/, function (req, res, next) {
    sysinfo.get(req, res, next);
  })

  // Inject a handler for /sysinfo/ that simply sneds the IndexPage (remember
  //  that the client uses HTML5 location handling from "/" and will itself
  //  request more content to populate the page).
  router.get(/^\/sysinfo\//, function (req, res, next) {
    app.IndexPageApplication.IndexPage(req, res, next);
  });

}

function get(req, res, next) {
  var app = module.app;

  context.sysinfoEntry.content = data;
  context.res.send(JSON.stringify(context.sysinfo));
}
