module.exports = keepass;
module.exports.get = get;
module.app = {};

var fs = require("fs");
var path = require("path");

function keepass(_app, router) {
  app = module.app = _app;

  //  WikiPage and markdownRenderer providers
  //app.ClientScripts['single page application'].push({
  //  name: 'components.wikipages.js',
  //  offline_path: app.Settings['node modules directory'] + '/irulanwiki/components.wikipages.js'
  //})
  app.ClientScripts['single page application'].push({
    name: 'irulankeepass.js',
    offline_path: app.Settings['node modules directory'] + '/irulankeepass/irulan_client_app.js'
  })

  // Inject handlers for RESTful requests for page content
  router.get(/^\/pages\/keepass\//, function (req, res, next) {
    wikipages.get(req, res, next);
  })
  router.get(/^\/pages\/keepass:/, function (req, res, next) {
    wikipages.get(req, res, next);
  })
}

function get(req, res, next) {
  var app = module.app;

  context.keepassEntry.content = data;
  context.res.send(JSON.stringify(context.wikipage));
}
