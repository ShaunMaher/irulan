module.exports = locallyCachedResources;
module.exports.sendFromCache = sendFromCache;

var fs = require("fs");
var path = require("path");
var cachedJsDir = "";
var cachedCssDir = "";

function locallyCachedResources(_cachedJsDir, _cachedCssDir) {
  cachedJsDir = _cachedJsDir;
  cachedCssDir = _cachedCssDir;
}

function sendFromCache(req, res, next) {
  var context = [];
  context.req = req;
  context.res = res;
  context.next = next;

  context.fileName = path.basename(req._parsedUrl.path);
  context.fileExt = path.extname(context.fileName);
  console.log(context.fileName);
  if (context.fileExt == ".js") {
    fs.access(cachedJsDir + context.fileName, fs.R_OK, (function (err) {
      if (err) {
        console.log("Cached .js file not found: '" + this.fileName + "'");
        this.next();
      }
      else {
        console.log("Sending cached version of: '" + this.fileName + "'");
        res.sendFile(cachedJsDir + this.fileName);
      }
    }).bind(context));
  }
  else if (context.fileExt == ".css") {
    fs.access(cachedCssDir + context.fileName, fs.R_OK, (function (err) {
      if (err) {
        console.log("Cached .css file not found: '" + this.fileName + "'");
        this.next();
      }
      else {
        console.log("Sending cached version of: '" + this.fileName + "'");
        res.sendFile(cachedCssDir + this.fileName);
      }
    }).bind(context));
  }
  else {
    next();
  }
}
