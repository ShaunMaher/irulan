// Register our ability to handle page requests in the "wiki/" name space
irulan.run(['WorkspaceProviders', 'Card', 'Cards', function(WorkspaceProviders, Card, Cards) {
  // How can I push the factory?
  WorkspaceProviders.push({
    namespace: null,
    factory: Card,
    workspace: Cards,
  });
}]);

irulan.factory('Card', function() {
  function Card() {
    this.name = '';
    this.title = 'Loading';
    this.sourceFormat = 'txt';
    this.content = 'empty content here';
  }
  //Page.prototype = {
  //  test: function() {
  //    return this.name;
  //  }
  //}
  return (Card);
})

irulan.service('Cards', ['Card', 'WorkspaceProviders', '$resource', function(Card, WorkspaceProviders, $resource){
  this.show = function(options, $scope, callback) {
    console.log("Show Cards scope:")
    console.log($scope);

    //TODO: unhide the cardsworkspace div

    //TODO: I think that if we specifically target the correct
    //  NameSpaceProvider's own array of pages then we can have multiple apps
    //  using the common "Pages" provider with the actual pages for that
    //  namespace shown.
    $scope.cards = this.cards;

    $scope.cards[options.name] = this.get(options, function () {
      console.log("Show cards callback");
      callback();
    });
  }

  this.hide = function() {
    //TODO: hide the pagesworkspace div
  }
}])

irulan.directive('card', function() {
  return {
    restrict: 'E',
    transclude: true,
    template:
      '    <div class="col-md-6" style="display: inline;">'+
      '        <div class="card">'+
      '            <div class="card-image">'+
      '                <img class="img-responsive" src="http://material-design.storage.googleapis.com/publish/v_2/material_ext_publish/0Bx4BSt6jniD7TDlCYzRROE84YWM/materialdesign_introduction.png">'+
      '                <span class="card-title">Material Cards</span>'+
      '            </div>'+
      '            <div class="card-content">'+
      '                <p>Cards for display in portfolio style material design by Google.</p>'+
      '            </div>'+
      '            <div class="card-action">'+
      '                <a href="#" target="new_blank">Link</a>'+
      '                <a href="#" target="new_blank">Link</a>'+
      '                <a href="#" target="new_blank">Link</a>'+
      '                <a href="#" target="new_blank">Link</a>'+
      '                <a href="#" target="new_blank">Link</a>'+
      '            </div>'+
      '        </div>'+
      '    </div>'
  }
});

irulan.directive('cards', function() {
  console.log("cards directive")
  return {
    restrict: 'E',
    transclude: true,
    template:
      '<div id="cardsworkspace">'+
      '  <div class="container">'+
      '    <card ng-repeat="(name, card) in cards" ng-pagename="{{name}}">{{name}}</card>'+
      '    <ng-transclude></ng-transclude>'+
      '  </div>'+
      '</div>',
  }
})
